# PowerSync Sync Rules Configuration
# Edition 2 with backwards-incompatible fixes
# See https://docs.powersync.com/usage/sync-rules/compatibility
config:
  edition: 2

# Define sync rules to control which data is synced to each user
bucket_definitions:
  # Global bucket - data accessible to all users
  global:
    data:
      # Profiles are shared so users can see each other's profiles
      - SELECT * FROM profiles

  # User-specific bucket - each user only sees their own data
  user_data:
    parameters: SELECT request.user_id() as user_id
    data:
      # Calendar & Appointments
      - SELECT * FROM appointment WHERE user_id = bucket.user_id

      # Finance Module
      - SELECT * FROM bank_account WHERE user_id = bucket.user_id
      - SELECT * FROM finance_category WHERE user_id = bucket.user_id
      - SELECT * FROM finance_client WHERE user_id = bucket.user_id
      - SELECT * FROM finance_project WHERE user_id = bucket.user_id
      - SELECT * FROM finance_project_adjustment WHERE user_id = bucket.user_id
      - SELECT * FROM finance_project_category WHERE user_id = bucket.user_id
      - SELECT * FROM finance_project_client WHERE user_id = bucket.user_id
      - SELECT * FROM recurring_cash_flow WHERE user_id = bucket.user_id
      - SELECT * FROM recurring_cash_flow_category WHERE user_id = bucket.user_id
      - SELECT * FROM single_cash_flow WHERE user_id = bucket.user_id
      - SELECT * FROM single_cash_flow_category WHERE user_id = bucket.user_id
      - SELECT * FROM payout WHERE user_id = bucket.user_id

      # Work/Timer Module
      - SELECT * FROM timer_project WHERE user_id = bucket.user_id
      - SELECT * FROM timer_project_category WHERE user_id = bucket.user_id
      - SELECT * FROM timer_project_folder WHERE user_id = bucket.user_id
      - SELECT * FROM timer_session WHERE user_id = bucket.user_id

      # Settings
      - SELECT * FROM settings WHERE user_id = bucket.user_id

  user_lists:
    # Separate bucket per To-Do list
    parameters: select id as list_id from lists where owner_id = request.user_id()
    data:
      - select * from lists where id = bucket.list_id
      - select * from todos where list_id = bucket.list_id



